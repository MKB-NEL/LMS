<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laptop Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        .btn-primary, .btn-danger, .btn-success, .btn-info {
            transition: background-color 0.3s;
        }
        .btn-primary:hover, .btn-danger:hover, .btn-success:hover, .btn-info:hover {
            filter: brightness(90%);
        }
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #343a40;
            color: white;
            text-align: center;
            padding: 1rem;
        }
        .nav-btn {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="#">Laptop Management System</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button class="btn btn-outline-primary nav-btn" onclick="showSection('addStudentSection')">ADD STUDENT</button>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-primary nav-btn" onclick="showSection('recordsSection')">LIST</button>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-primary nav-btn" onclick="showSection('analyticsSection')">ANALYZE</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <!-- Add Student Form -->
        <div id="addStudentSection" class="card shadow mb-5">
            <div class="card-body p-4">
                <h2 class="card-title h4 mb-4 text-primary">Add Student</h2>
                <div class="row g-3">
                    <div class="col-md-6">
                        <input id="studentName" type="text" class="form-control" placeholder="Student Name" required>
                    </div>
                    <div class="col-md-6">
                        <select id="studentClass" class="form-select" required>
                            <option value="" disabled selected>Select Class Combination</option>
                            <option value="S4MCE">S4MCE</option>
                            <option value="S4MEG">S4MEG</option>
                            <option value="S4PCB">S4PCB</option>
                            <option value="S4PCM">S4PCM</option>
                            <option value="S4MCB">S4MCB</option>
                            <option value="S4LFK">S4LFK</option>
                            <option value="S5MCE">S5MCE</option>
                            <option value="S5MEG">S5MEG</option>
                            <option value="S5PCB">S5PCB</option>
                            <option value="S5PCM">S5PCM</option>
                            <option value="S5MCB">S5MCB</option>
                            <option value="S5LFK">S5LFK</option>
                            <option value="S6MCE">S6MCE</option>
                            <option value="S6MEG">S6MEG</option>
                            <option value="S6PCB">S6PCB</option>
                            <option value="S6PCM">S6PCM</option>
                            <option value="S6MCB">S6MCB</option>
                            <option value="S6LFK">S6LFK</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <input id="computerBrand" type="text" class="form-control" placeholder="Computer Brand & Charger" required>
                    </div>
                    <div class="col-md-6">
                        <input id="description" type="text" class="form-control" placeholder="Description">
                    </div>
                    <div class="col-12">
                        <input id="additionalEquipment" type="text" class="form-control" placeholder="Additional Equipment (e.g., headphones, radio)">
                    </div>
                    <div class="col-12">
                        <button onclick="addStudent()" class="btn btn-primary w-100 fw-bold">ADD STUDENT</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Records List -->
        <div id="recordsSection" class="card shadow mb-5 d-none">
            <div class="card-body p-4">
                <h2 class="card-title h4 mb-4 text-primary">Student Records</h2>
                <div id="recordsList" class="row g-3"></div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analyticsSection" class="card shadow mb-5 d-none">
            <div class="card-body p-4">
                <h2 class="card-title h4 mb-4 text-primary">Analytics</h2>
                <div id="analyticsContent" class="row g-3"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Made by Bertrand</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load records from local storage
        let records = JSON.parse(localStorage.getItem('laptopRecords')) || [];

        // Update list on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateList();
            showSection('addStudentSection'); // Show Add Student section by default
        });

        // Show specific section
        function showSection(sectionId) {
            const sections = ['addStudentSection', 'recordsSection', 'analyticsSection'];
            sections.forEach(id => {
                document.getElementById(id).classList.add('d-none');
            });
            document.getElementById(sectionId).classList.remove('d-none');
            if (sectionId === 'analyticsSection') {
                updateAnalytics();
            }
        }

        // Add student
        function addStudent() {
            const studentName = document.getElementById('studentName').value.trim();
            const studentClass = document.getElementById('studentClass').value;
            const computerBrand = document.getElementById('computerBrand').value.trim();
            const description = document.getElementById('description').value.trim();
            const additionalEquipment = document.getElementById('additionalEquipment').value.trim();

            if (!studentName || !studentClass || !computerBrand) {
                alert('Please fill in all required fields (Name, Class, Computer Brand).');
                return;
            }

            const record = {
                studentName,
                studentClass,
                computerBrand,
                description,
                additionalEquipment,
                status: 'in',
                checkoutTime: null,
                history: []
            };
            records.push(record);
            localStorage.setItem('laptopRecords', JSON.stringify(records));

            updateList();

            // Clear form
            document.getElementById('studentName').value = '';
            document.getElementById('studentClass').value = '';
            document.getElementById('computerBrand').value = '';
            document.getElementById('description').value = '';
            document.getElementById('additionalEquipment').value = '';
        }

        // Handle check-out
        function checkOut(index) {
            records[index].status = 'out';
            records[index].checkoutTime = new Date().toISOString();
            records[index].history.push({ action: 'checkout', time: records[index].checkoutTime });
            localStorage.setItem('laptopRecords', JSON.stringify(records));
            updateList();
        }

        // Handle check-in
        function checkIn(index) {
            if (records[index].status === 'out') {
                const checkoutTime = new Date(records[index].checkoutTime);
                const checkinTime = new Date();
                records[index].status = 'in';
                records[index].checkoutTime = null;
                records[index].history.push({ action: 'checkin', time: checkinTime.toISOString(), duration: ((checkinTime - checkoutTime) / (1000 * 60 * 60)).toFixed(2) });
                localStorage.setItem('laptopRecords', JSON.stringify(records));
                updateList();
            }
        }

        // Update records list
        function updateList() {
            const list = document.getElementById('recordsList');
            list.innerHTML = '';

            records.forEach((record, index) => {
                const recordDiv = document.createElement('div');
                recordDiv.className = 'col-12';
                recordDiv.innerHTML = `
                    <div class="card p-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-1">${record.studentName}</h5>
                                <p class="mb-1">Class: ${record.studentClass}</p>
                                <p class="mb-1">Computer: ${record.computerBrand}</p>
                                ${record.status === 'out' ? '<p class="text-warning fw-bold mb-1">IT IS OUT</p>' : ''}
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <button onclick="checkOut(${index})" class="${record.status === 'out' ? 'd-none' : ''} btn btn-danger btn-sm">OUT</button>
                                <button onclick="checkIn(${index})" class="${record.status === 'in' ? 'd-none' : ''} btn btn-success btn-sm">IN</button>
                                <button class="btn btn-link text-primary" data-bs-toggle="modal" data-bs-target="#detailsModal${index}">...</button>
                            </div>
                        </div>
                    </div>
                    <!-- Modal for Details -->
                    <div class="modal fade" id="detailsModal${index}" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">${record.studentName}'s Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <p><strong>Description:</strong> ${record.description || 'N/A'}</p>
                                    <p><strong>Additional Equipment:</strong> ${record.additionalEquipment || 'N/A'}</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                list.appendChild(recordDiv);
            });
        }

        // Update analytics with graphs
        function updateAnalytics() {
            const analyticsContent = document.getElementById('analyticsContent');
            analyticsContent.innerHTML = '';

            const today = new Date().toISOString().split('T')[0];
            const weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());

            records.forEach((record, index) => {
                const history = record.history || [];
                const daysUsed = [...new Set(history.map(h => new Date(h.time).toISOString().split('T')[0]))].length;
                const weekHistory = history.filter(h => new Date(h.time) >= weekStart);
                const totalWeekDuration = weekHistory
                    .filter(h => h.duration)
                    .reduce((sum, h) => sum + parseFloat(h.duration), 0)
                    .toFixed(2);
                const todayHistory = history.filter(h => h.time.startsWith(today));
                const todayUsage = todayHistory
                    .filter(h => h.action === 'checkout')
                    .map(h => {
                        const checkin = history.find(c => c.action === 'checkin' && new Date(c.time) > new Date(h.time));
                        return checkin ? `${new Date(h.time).toLocaleTimeString()} - ${new Date(checkin.time).toLocaleTimeString()}` : '';
                    })
                    .filter(t => t)
                    .join(', ');

                // Prepare data for bar chart
                const daysData = Array(7).fill(0);
                history
                    .filter(h => h.duration && new Date(h.time) >= weekStart)
                    .forEach(h => {
                        const dayIndex = new Date(h.time).getDay();
                        daysData[dayIndex] += parseFloat(h.duration);
                    });

                const analyticsDiv = document.createElement('div');
                analyticsDiv.className = 'col-12';
                analyticsDiv.innerHTML = `
                    <div class="card p-3">
                        <h5 class="mb-1">${record.studentName} (${record.studentClass})</h5>
                        <p class="mb-1">Days Used: ${daysUsed}</p>
                        <p class="mb-1">Total Time This Week: ${totalWeekDuration} hrs</p>
                        <p class="mb-3">Today's Usage: ${todayUsage || 'None'}</p>
                        <canvas id="chart${index}" height="100"></canvas>
                    </div>
                `;
                analyticsContent.appendChild(analyticsDiv);

                // Create bar chart
                new Chart(document.getElementById(`chart${index}`), {
                    type: 'bar',
                    data: {
                        labels: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                        datasets: [{
                            label: 'Hours Used',
                            data: daysData,
                            backgroundColor: 'rgba(0, 123, 255, 0.5)',
                            borderColor: 'rgba(0, 123, 255, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Hours' }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            });
        }
    </script>
</body>
</html>
